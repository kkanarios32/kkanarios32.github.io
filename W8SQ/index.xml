<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/default.xsl"?>
<fr:tree xmlns:fr="http://www.forester-notes.org" xmlns:html="http://www.w3.org/1999/xhtml" xmlns:xml="http://www.w3.org/XML/1998/namespace" root="false" base-url="/">
  <fr:frontmatter>
    <fr:authors />
    <fr:date>
      <fr:year>2025</fr:year>
      <fr:month>8</fr:month>
      <fr:day>16</fr:day>
    </fr:date>
    <fr:uri>https://kellenkanarios.com/W8SQ/</fr:uri>
    <fr:display-uri>W8SQ</fr:display-uri>
    <fr:route>/W8SQ/</fr:route>
    <fr:title text="Locks">Locks</fr:title>
  </fr:frontmatter>
  <fr:mainmatter />
  <fr:backmatter>
    <fr:tree show-metadata="false" hidden-when-empty="true">
      <fr:frontmatter>
        <fr:authors />
        <fr:title text="References">References</fr:title>
      </fr:frontmatter>
      <fr:mainmatter />
    </fr:tree>
    <fr:tree show-metadata="false" hidden-when-empty="true">
      <fr:frontmatter>
        <fr:authors />
        <fr:title text="Context">Context</fr:title>
      </fr:frontmatter>
      <fr:mainmatter>
        <fr:tree show-metadata="true" expanded="false" toc="false" numbered="false">
          <fr:frontmatter>
            <fr:authors />
            <fr:date>
              <fr:year>2025</fr:year>
              <fr:month>8</fr:month>
              <fr:day>16</fr:day>
            </fr:date>
            <fr:uri>https://kellenkanarios.com/5P43/</fr:uri>
            <fr:display-uri>5P43</fr:display-uri>
            <fr:route>/5P43/</fr:route>
            <fr:title text="Concurrency">Concurrency</fr:title>
          </fr:frontmatter>
          <fr:mainmatter>
            <fr:tree show-metadata="false">
              <fr:frontmatter>
                <fr:authors />
                <fr:date>
                  <fr:year>2025</fr:year>
                  <fr:month>8</fr:month>
                  <fr:day>16</fr:day>
                </fr:date>
                <fr:uri>https://kellenkanarios.com/16TG/</fr:uri>
                <fr:display-uri>16TG</fr:display-uri>
                <fr:route>/16TG/</fr:route>
                <fr:title text="Concurrency Intro">Concurrency Intro</fr:title>
              </fr:frontmatter>
              <fr:mainmatter><html:p>Each <html:em>thread</html:em> contains its own program counter (PC) and a private set of registers. They do <html:strong>NOT</html:strong> contain their own address space like a process.</html:p><html:p>Similar to the process control block (PCB), in order to perform a context switch each process needs a <html:em>thread control block</html:em>(TCB).</html:p><html:p>Additionally, the process needs one stack <html:strong>per-thread</html:strong>. This does ruin our neatly partitioned address space. However, it is generally OK because each individual stack is not too large.</html:p><html:p><html:strong>Why do we use threads?</html:strong></html:p><html:ol><html:li><html:em>Intra-process parallelism</html:em>: within a process, there are often highly parallelizable components. However, we do not want to have to divide the program into processes and perform the much more expensive context switch.</html:li>
  <html:li><html:em>Avoid blocking I/O</html:em>: even if you do not want to parallelize your program you can still use a thread to avoid blocking I/O by just having that thread blocked while you continue doing other work.</html:li></html:ol>
   
   <fr:tree show-metadata="false" toc="false"><fr:frontmatter><fr:authors /><fr:date><fr:year>2025</fr:year><fr:month>8</fr:month><fr:day>16</fr:day></fr:date><fr:taxon>Example</fr:taxon></fr:frontmatter><fr:mainmatter>
Suppose we have the following sequence of instructions (pseudo-assembly)
<html:pre><![CDATA[  mov addr reg
  add 1 reg
  mov reg addr]]></html:pre>
If you have two threads running this and hope the end result is that you increment the corresponding variable by two, then you might be in for some disappointment. This is a <html:em>non-atomic</html:em> operation because conceivably 
<html:ol><html:li>thread 1 could store the value of the register</html:li> 
 <html:li>thread 2 could store the value of the register</html:li>
 <html:li>thread 1 increments</html:li>
 <html:li>thread 2 increments</html:li>
 <html:li>end result is only <html:strong>1</html:strong> increment</html:li></html:ol>
This is a <html:em>race condition</html:em> and code that is accessed by multiple threads is the <html:em>critical section</html:em>.
</fr:mainmatter></fr:tree>
 
</fr:mainmatter>
            </fr:tree>
            <fr:tree show-metadata="false">
              <fr:frontmatter>
                <fr:authors />
                <fr:date>
                  <fr:year>2025</fr:year>
                  <fr:month>8</fr:month>
                  <fr:day>16</fr:day>
                </fr:date>
                <fr:uri>https://kellenkanarios.com/W8SQ/</fr:uri>
                <fr:display-uri>W8SQ</fr:display-uri>
                <fr:route>/W8SQ/</fr:route>
                <fr:title text="Locks">Locks</fr:title>
              </fr:frontmatter>
              <fr:mainmatter />
            </fr:tree>
          </fr:mainmatter>
        </fr:tree>
      </fr:mainmatter>
    </fr:tree>
    <fr:tree show-metadata="false" hidden-when-empty="true">
      <fr:frontmatter>
        <fr:authors />
        <fr:title text="Backlinks">Backlinks</fr:title>
      </fr:frontmatter>
      <fr:mainmatter />
    </fr:tree>
    <fr:tree show-metadata="false" hidden-when-empty="true">
      <fr:frontmatter>
        <fr:authors />
        <fr:title text="Related">Related</fr:title>
      </fr:frontmatter>
      <fr:mainmatter />
    </fr:tree>
    <fr:tree show-metadata="false" hidden-when-empty="true">
      <fr:frontmatter>
        <fr:authors />
        <fr:title text="Contributions">Contributions</fr:title>
      </fr:frontmatter>
      <fr:mainmatter />
    </fr:tree>
  </fr:backmatter>
</fr:tree>
